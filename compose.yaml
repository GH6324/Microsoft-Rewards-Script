services:
    microsoft-rewards-script:
        image: ghcr.io/thenetsky/microsoft-rewards-script:latest
        container_name: microsoft-rewards-script
        restart: unless-stopped
        volumes:
            - ./config:/usr/src/microsoft-rewards-script/dist/config
            - ./sessions:/usr/src/microsoft-rewards-script/dist/browser/sessions
        environment:

            # ── Scheduling ───────────────────────────────────────────────────
            TZ: 'America/Toronto'
            NODE_ENV: 'production'
            CRON_SCHEDULE: '0 7 * * *'   # use crontab.guru to customize your schedule
            RUN_ON_START: 'true'          # run script immediately on container start
            SKIP_RANDOM_SLEEP: 'false'
            #MIN_SLEEP_MINUTES: "5"
            #MAX_SLEEP_MINUTES: "50"
            #STUCK_PROCESS_TIMEOUT_HOURS: "8"  

            # ── Accounts ─────────────────────────────────────────────────────
            ACCOUNT_1_EMAIL: ${ACCOUNT_1_EMAIL}
            ACCOUNT_1_PASSWORD: ${ACCOUNT_1_PASSWORD}
            #ACCOUNT_1_TOTP_SECRET: ${ACCOUNT_1_TOTP_SECRET}
            #ACCOUNT_1_RECOVERY_EMAIL: ${ACCOUNT_1_RECOVERY_EMAIL}
            #ACCOUNT_1_GEO_LOCALE: ${ACCOUNT_1_GEO_LOCALE}
            #ACCOUNT_1_LANG_CODE: ${ACCOUNT_1_LANG_CODE}
            #ACCOUNT_1_PROXY_AXIOS: ${ACCOUNT_1_PROXY_AXIOS}
            #ACCOUNT_1_PROXY_URL: ${ACCOUNT_1_PROXY_URL}
            #ACCOUNT_1_PROXY_PORT: ${ACCOUNT_1_PROXY_PORT}
            #ACCOUNT_1_PROXY_USERNAME: ${ACCOUNT_1_PROXY_USERNAME}
            #ACCOUNT_1_PROXY_PASSWORD: ${ACCOUNT_1_PROXY_PASSWORD}
            #
            #ACCOUNT_2_EMAIL: ${ACCOUNT_2_EMAIL}
            #ACCOUNT_2_PASSWORD: ${ACCOUNT_2_PASSWORD}
            # Add additional accounts as ACCOUNT_3_*, ACCOUNT_4_*, etc. following the same pattern

            # ── Configuration ───────────────────────────────────────────────
            # Uncomment to override defaults, a full list of configuration options are in the README.
            # 
            # General:
            #CONFIG_CLUSTERS: '1'
            #
            # Search behaviour:
            #CONFIG_SEARCH_DELAY_MIN: '30sec'
            #CONFIG_SEARCH_DELAY_MAX: '1min'
            #
            # Discord webhook:
            #CONFIG_DISCORD_ENABLED: 'true'
            #CONFIG_DISCORD_URL: 'https://discord.com/api/webhooks/...'
            #
            # ntfy webhook:
            #CONFIG_NTFY_ENABLED: 'true'
            #CONFIG_NTFY_URL: 'https://ntfy.sh'
            #CONFIG_NTFY_TOPIC: 'my-rewards-alerts'
            #CONFIG_NTFY_TOKEN: ''
            #CONFIG_NTFY_TITLE: 'Microsoft-Rewards-Script'
            #CONFIG_NTFY_PRIORITY: '3'
            #
            # Webhook log filter (controls which events trigger webhook notifications, enable when using NTFY):
            #CONFIG_WEBHOOK_LOG_FILTER_ENABLED: 'false'
            #CONFIG_WEBHOOK_LOG_FILTER_MODE: 'whitelist'      # whitelist or blacklist
            #CONFIG_WEBHOOK_LOG_FILTER_LEVELS: 'error'        # comma-separated
            #CONFIG_WEBHOOK_LOG_FILTER_KEYWORDS: 'starting account,select number,collected'

        healthcheck:
            test: ['CMD', 'sh', '-c', 'pgrep cron > /dev/null || exit 1']
            interval: 60s
            timeout: 10s
            retries: 3
            start_period: 30s

        security_opt:
            - no-new-privileges:true
